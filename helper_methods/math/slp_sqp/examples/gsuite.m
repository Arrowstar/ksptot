function [df,dg] = gsuite( x, pnum, activeSet )%% GSUITE Gradients for sqp.m optimization test problems%%--Inputs%%  x........... Design variable vector%  pnum........ Problem number%  activeSet... Flag to use active set stragegy%%--Outputs%%  df....... Derivatives of Objective function value evaluated at x%  dg....... Derivatives of Constraint function values evaluated at x%%  Written by:      Robert A. Canfield%  Created:         2/20/95%  Modified:        6/03/20%--Modifications%%   3/13/95 - Added Spillman & chopper problems%             Call fsuite to find nx & ng%   3/26/95 - Repair gradients for #3,6,17%   5/25/04 - Accomodate active constraint set strategy%   6/03/20 - 3rd input argument allActive for active set strategy%--Local variables%%  nx....... Number of design variables in each problem%  ng....... Number of constraints in each problemglobal ACTIVE_CONSTRAINTS%--BEGIN%[nx,ng]=fsuite([],pnum);activeSet = nargin<3 || (~isempty(activeSet) && activeSet);%%  CASE of problem number.%% First 16 problems are from Venkayya & Tischler%%   problem 1:if pnum==1      df(1) = 10;      df(2) = 1;%      dg(1,1) = 2;      dg(1,2) = -1;      dg(2,1) = 1;      dg(2,2) = -2;      dg(3,1) = 2 - 2*x(1);      dg(3,2) = 2;%%   problem 2:elseif pnum==2      k = sqrt(1.0 + x(2)^2);      df(1) = k;      df(2) = x(1)*x(2)/k;%      dg(1,1) =  0.124*k*(8/x(1)^2 + 1/(x(2)*x(1)^2));      dg(1,2) =  0.124*(k/(x(1)*x(2)^2) - (8/x(1) + 1/(x(1)*x(2)))*(x(2)/k));      dg(2,1) =  0.124*k*(8/x(1)^2 - 1/(x(2)*x(1)^2));      dg(2,2) = -0.124*(k/(x(1)*x(2)^2) + (8/x(1) - 1/(x(1)*x(2)))*(x(2)/k));%%   problem 3:elseif pnum==3      df(1) = 4;      df(2) = 1;%      dg(1,1) = 4/(x(2) + 0.25*x(1))^2;      dg(1,2) = 16/(x(2) + 0.25*x(1))^2;      dg(2,1) = 0.5/(x(1) + 0.25*x(1))^2 + sqrt(3.0)/(3*x(1)^2);      dg(2,2) = 2/(x(2) + 0.25*x(1))^2;%%   problem 4:elseif pnum==4      df = 0.0624*ones(nx,1);%         dg(1,1) = 3*61/x(1)^4;         dg(1,2) = 3*37/x(2)^4;         dg(1,3) = 3*19/x(3)^4;         dg(1,4) = 3*7/x(4)^4;         dg(1,5) = 3/x(5)^4;%%   problem 5:elseif pnum==5      df(1) = 30*x(3) + 15*x(2);      df(2) = 20*x(3) + 15*x(1);      df(3) = 20*x(2) + 30*x(1);%      dg(1,1) = -x(2)*x(3);      dg(1,2) = -x(1)*x(3);      dg(1,3) = -x(1)*x(2);%%   problem 6:elseif pnum==6      df(1) = 0.7854*(x(2)^2)*(3.3333*x(3)^2 + 14.9334*x(3) - 43.0934);      df(1) = df(1) -1.508*(x(6)^2 + x(7)^2);      df(2) = 0.7854*2*x(1)*x(2)*(3.3333*x(3)^2 + 14.9334*x(3) - 43.0934);      df(3) = 0.7854*x(1)*(x(2)^2)*(2*3.3333*x(3) + 14.9334);      df(4) = 0.7854*x(6)^2;      df(5) = 0.7854*x(7)^2;      df(6) = -2*1.508*x(1)*x(6) + 3*7.477*x(6)^2 + 2*0.7854*x(4)*x(6);      df(7) = -2*1.508*x(1)*x(7) + 3*7.477*x(7)^2 + 2*0.7854*x(5)*x(7);%      dg = zeros(ng,nx);           k5 = (745*x(4)/(x(2)*x(3)))^2 + 16.9*10^6;           k6 = (745*x(5)/(x(2)*x(3)))^2 + 157.5*10^6;      dg(1,1) = 27*(x(1)^(-2))*(x(2)^(-2))*(x(3)^(-1));      dg(1,2) = 54*(x(1)^(-1))*(x(2)^(-3))*(x(3)^(-1));      dg(1,3) = 27*(x(1)^(-1))*(x(2)^(-2))*(x(3)^(-2));      dg(2,1) = 397.5*(x(1)^(-2))*(x(2)^(-2))*(x(3)^(-2));      dg(2,2) = 2*397.5*(x(1)^(-1))*(x(2)^(-3))*(x(3)^(-2));      dg(2,3) = 2*397.5*(x(1)^(-1))*(x(2)^(-2))*(x(3)^(-3));      dg(3,2) = 1.93*(x(2)^(-2))*(x(3)^(-1))*(x(4)^3)*(x(6)^(-4));      dg(3,3) = 1.93*(x(2)^(-1))*(x(3)^(-2))*(x(4)^3)*(x(6)^(-4));      dg(3,4) = -5.79*(x(2)^(-1))*(x(3)^(-1))*(x(4)^2)*(x(6)^(-4));      dg(3,6) = 7.72*(x(2)^(-1))*(x(3)^(-1))*(x(4)^3)*(x(6)^(-5));      dg(4,2) = 1.93*(x(2)^(-2))*(x(3)^(-1))*(x(4)^3)*(x(6)^(-4));      dg(4,3) = 1.93*(x(2)^(-1))*(x(3)^(-2))*(x(4)^3)*(x(6)^(-4));      dg(4,5) = -5.79*(x(2)^(-1))*(x(3)^(-1))*(x(5)^2)*(x(7)^(-4));      dg(4,7) = 7.72*(x(2)^(-1))*(x(3)^(-1))*(x(5)^3)*(x(7)^(-5));      dg(5,2) = (k5^(-.5)/(0.1*x(6)^3))*(-2)*((745*x(4)/x(3))^2)*(x(2)^(-3));      dg(5,3) = (k5^(-.5)/(0.1*x(6)^3))*(-2)*((745*x(4)/x(2))^2)*(x(3)^(-3));      dg(5,4) = -10*(x(6)^(-3))*(k5^(-0.5))*(745^2)*(x(4)/(x(2)*x(3)));      dg(5,6) = 30*(k5^0.5)*(x(6)^(-4));      dg(6,2) = (k6^(-.5)/(0.1*x(7)^3))*(-2)*((745*x(5)/x(3))^2)*(x(2)^(-3));      dg(6,3) = (k6^(-.5)/(0.1*x(7)^3))*(-2)*((745*x(5)/x(2))^2)*(x(3)^(-3));      dg(6,5) = -10*(x(7)^(-3))*(k6^(-0.5))*(745^2)*(x(5)/(x(2)*x(3)));      dg(6,7) = 30*(k6^0.5)*(x(7)^(-4));      dg(7,2) = -x(3);      dg(7,3) = -x(2);      dg(8,1) = -1/x(2);      dg(8,2) = x(1)/x(2)^2;      dg(9,1) = 1/x(2);      dg(9,2) = -x(1)/x(2)^2;      dg(10,4) = (1.5*x(6) + 1.9)*x(4)^(-2);      dg(10,6) = 1.5*x(4)^(-1);      dg(11,5) = (1.1*x(7) + 1.9)*x(5)^(-2);      dg(11,7) = 1.5*x(5)^(-1);%%   problem 7:elseif pnum==7      df(1) = x(2);      df(2) = x(1);%      dg(1,1) = x(2)^2;      dg(1,2) = 2*x(1)*x(2);      dg(2,1) = x(2);      dg(2,2) = x(1);      dg(3,1) = 2;      dg(3,2) = -1;%%   problem 8:elseif pnum==8      df(1) = 50;      df(2) = 40;      dg=[];%%   problem 9:elseif pnum==9      df(1) = 2*(x(1) - 1);      df(2) = 2*(x(2) - 1);%      dg(1,1) = -1;      dg(1,2) = -2;%%   problem 10:elseif pnum==10      df(1) = 2*(x(1) - 3);      df(2) = 2*(x(2) - 3);%      dg(1,1) = -1;      dg(1,2) = -1;%%   problem 11:elseif pnum==11      df(1) = 2*(x(1) - 1);      df(2) = 2*(x(2) - 1) - 2;%      dg(1,1) = -1;      dg(1,2) = -1;%%   problem 12:elseif pnum==12      df(1) = 2*x(1);      df(2) = 2*x(2);      df(3) = 2*x(3);%      dg(1,1) = 1;      dg(1,2) = 1;      dg(1,3) = 0;      dg(2,1) = 0;      dg(2,2) = 1;      dg(2,3) = 2;%%   problem 13:elseif pnum==13      df(1) = 8*x(1) - 5*x(2) - 8;      df(2) = 6*x(2) - 5*x(1);%      dg(1,1) = 1;      dg(1,2) = 1;%%   problem 14:elseif pnum==14      df(1) = 2*x(1);      df(2) = 2*x(2);      df(3) = 2*x(3);%      dg(1,1) = 32/x(1)^3;      dg(1,2) = 32/x(2)^3;      dg(1,3) = 0;      dg(2,1) = 0;      dg(2,2) = 32/x(2)^3;      dg(2,3) = 32/x(3)^3;%%   problem 15:elseif pnum==15      df(1) = 1;      df(2) = 2;%      dg(1,1) = 1/x(1)^2;      dg(1,2) = 0;      dg(2,1) = 0.375/(x(2) + x(1)/4)^2;      dg(2,2) = 1.5/(x(2) + x(1)/4)^2;%%   problem 16:elseif pnum==16      df(1) = 2*x(1) - 5;      df(2) = 2*x(2) - 5;      df(3) = 4*x(3) - 21;      df(4) = 2*x(4) + 7;%      dg(1,1) = -2*x(1) - 1;      dg(1,2) = -2*x(2) + 1;      dg(1,3) = -2*x(3) - 1;      dg(1,4) = -2*x(4) + 1;      dg(2,1) = -2*x(1) + 1;      dg(2,2) = -4*x(2);      dg(2,3) = -2*x(3);      dg(2,4) = -4*x(4) + 1;      dg(3,1) = -4*x(1) - 2;      dg(3,2) = -2*x(2) + 1;      dg(3,3) = -2*x(3);      dg(3,4) = -1;% Two of Schittkowski's problems%%   problem 17:elseif pnum==17      df(1) = 10*(x(2)^(-1))*(x(4)^2)*(x(6)^(-3))*(x(7)^.125) ...              - 15*(x(1)^(-2))*(x(2)^(-2))*x(3)*x(4)*(x(5)^(-1))*(x(7)^(-0.5)) ...              - 40*(x(1)^(-3))*x(2)*(x(4)^(-1))*(x(5)^(-2))*x(6) ...              + 50*x(1)*(x(2)^2)*(x(3)^(-1))*(x(5)^0.5)*(x(6)^(-2))*x(7);      df(2) = -10*x(1)*(x(2)^(-2))*(x(4)^2)*(x(6)^(-3))*(x(7)^.125) ...              - 30*(x(1)^(-1))*(x(2)^(-3))*x(3)*x(4)*(x(5)^(-1))*(x(7)^(-0.5)) ...              + 20*(x(1)^(-2))*(x(4)^(-1))*(x(5)^(-2))*x(6) ...              + 50*(x(1)^2)*x(2)*(x(3)^(-1))*(x(5)^0.5)*(x(6)^(-2))*x(7);      df(3) = 15*(x(1)^(-1))*(x(2)^(-2))*x(4)*(x(5)^(-1))*x(7)^(-0.5) ...              - 25*(x(1)^2)*(x(2)^2)*(x(3)^(-2))*(x(5)^0.5)*(x(6)^(-2))*x(7);      df(4) = 20*x(1)*(x(2)^(-1))*x(4)*(x(6)^(-3))*(x(7)^.125) ...              + 15*(x(1)^(-1))*(x(2)^(-2))*x(3)*(x(5)^(-1))*(x(7)^(-0.5)) ...              - 20*(x(1)^(-2))*x(2)*(x(4)^(-2))*(x(5)^(-2))*x(6);      df(5) = -15*(x(1)^(-1))*(x(2)^(-2))*x(3)*x(4)*(x(5)^(-2))*(x(7)^(-0.5)) ...              - 40*(x(1)^(-2))*x(2)*(x(4)^(-1))*(x(5)^(-3))*x(6) ...              + 12.5*(x(1)^2)*(x(2)^2)*(x(3)^(-1))*(x(5)^0.5)*(x(6)^(-2))*x(7);      df(6) = -30*x(1)*(x(2)^(-1))*(x(4)^2)*(x(6)^(-4))*(x(7)^.125) ...              + 20*(x(1)^(-2))*x(2)*(x(4)^(-1))*(x(5)^(-2)) ...              - 50*(x(1)^2)*(x(2)^2)*(x(3)^(-1))*(x(5)^0.5)*(x(6)^(-3))*x(7);      df(7) = 1.25*x(1)*(x(2)^(-1))*(x(4)^2)*(x(6)^(-3))*(x(7)^(-0.875)) ...              - 7.5*(x(1)^(-1))*(x(2)^(-2))*x(3)*x(4)*(x(5)^(-1))*x(7)^(-1.5) ...              + 25*(x(1)^2)*(x(2)^2)*(x(3)^(-1))*(x(5)^0.5)*(x(6)^(-2));%      dg(1,1) = -0.25*(x(1)^(-0.5))*(x(3)^(-1))*(x(6)^(-2))*x(7) ...            - 2.1*(x(1)^2)*x(2)*(x(3)^(-2))*x(6)*(x(7)^0.5);%      dg(1,2) = -0.7*(x(1)^3)*(x(3)^(-2))*x(6)*(x(7)^0.5) ...              + 0.2*(x(2)^(-2))*x(3)*(x(4)^(-0.5))*(x(6)^(2.0/3.0))*(x(7)^0.25);%      dg(1,3) = 0.5*(x(1)^0.5)*(x(3)^(-2))*(x(6)^(-2))*x(7) ...            + 1.4*(x(1)^3)*x(2)*(x(3)^(-3))*x(6)*(x(7)^0.5) ...            - 0.2*(x(2)^(-1))*(x(4)^(-0.5))*(x(6)^(2.0/3.0))*(x(7)^0.25);%%     dg(1,4) = 1.0*(x(2)^(-1))*x(3)*(x(4)^(-1.5))*(x(6)^(2.0/3.0))*(x(7)^0.25);      dg(1,4) = 0.1*(x(2)^(-1))*x(3)*(x(4)^(-1.5))*(x(6)^(2.0/3.0))*(x(7)^0.25);%      dg(1,5) = 0.0;%      dg(1,6) = (x(1)^(-0.5))*(x(3)^(-1))*(x(6)^(-3))*x(7) ...            - 0.7*(x(1)^3)*x(2)*(x(3)^(-2))*(x(7)^0.5) ...            - (4./30.)*(x(2)^(-1))*x(3)*(x(4)^(-0.5))*(x(6)^(-1./3.))*(x(7)^.25);%      dg(1,7) = - 0.5*(x(1)^0.5)*(x(3)^(-1))*(x(6)^(-2)) ...            - 0.35*(x(1)^3)*x(2)*(x(3)^(-2))*x(6)*(x(7)^(-0.5)) ...            - 0.05*(x(2)^(-1))*x(3)*(x(4)^(-0.5))*(x(6)^(2.0/3.0))*(x(7)^(-0.75));%      dg(2,1) = 0.65*(x(1)^(-1.5))*x(2)*(x(3)^(-1))*(x(5)^(-1))*x(6) ...            + 3.1*(x(1)^(-2))*(x(2)^0.5)*(x(4)^(-2))*(x(5)^(-1))*(x(6)^(1.0/3.0));%      dg(2,2) = -1.3*(x(1)^(-0.5))*(x(3)^(-1))*(x(5)^(-1))*x(6) ...            - 1.55*(x(1)^(-1))*(x(2)^(-0.5))*(x(4)^(-2))*(x(5)^(-1))*(x(6)^(1./3.));%      dg(2,3) = 1.3*(x(1)^(-0.5))*x(2)*(x(3)^(-2))*(x(5)^(-1))*x(6) ...            - 0.8*(x(4)^(-1))*(x(5)^(-1))*(x(6)^2);%      dg(2,4) = 0.8*x(3)*(x(4)^(-2))*(x(5)^(-1))*(x(6)^2) ...            + 6.2*(x(1)^(-1))*(x(2)^0.5)*(x(4)^(-3))*(x(5)^(-1))*(x(6)^(1.0/3.0));%           - 6.2*(x(1)^(-1))*(x(2)^0.5)*(x(4)^(-3))*(x(5)^(-1))*(x(6)^(1.0/3.0));%      dg(2,5) = 1.3*(x(1)^(-0.5))*x(2)*(x(3)^(-1))*(x(5)^(-2))*x(6) ...            + 0.8*x(3)*(x(4)^(-1))*(x(5)^(-2))*(x(6)^2) ...            + 3.1*(x(1)^(-1))*(x(2)^0.5)*(x(4)^(-2))*(x(5)^(-2))*(x(6)^(1.0/3.0));%      dg(2,6) = -1.3*(x(1)^(-0.5))*x(2)*(x(3)^(-1))*(x(5)^(-1)) ...            - 1.6*x(3)*(x(4)^(-1))*(x(5)^(-1))*x(6) - ...          (31./30.)*(x(1)^(-1))*(x(2)^.5)*(x(4)^(-2))*(x(5)^(-1))*(x(6)^(-2./3.));      dg(2,7) = 0.0;%      dg(3,1) = -2*(x(3)^(-1.5))*x(5)*(x(6)^(-1))*(x(7)^(1.0/3.0)) ...            + (x(1)^(-2))*x(2)*(x(3)^0.5)*x(5);%      dg(3,2) = - 0.1*(x(3)^(-0.5))*x(5)*(x(6)^(-1))*(x(7)^(-0.5)) ...            - (x(1)^(-1))*(x(3)^0.5)*x(5) ...            + 1.3*(x(2)^(-3))*x(3)*x(5)*(x(6)^(-1))*x(7);%%     dg(3,3) = -3*x(1)*(x(3)^(-2.5))*x(5)*(x(6)^(-1))*(x(7)^(1.0/3.0)) ...      dg(3,3) =  3*x(1)*(x(3)^(-2.5))*x(5)*(x(6)^(-1))*(x(7)^(1.0/3.0)) ...            + 0.05*x(2)*(x(3)^(-1.5))*x(5)*(x(6)^(-1))*(x(7)^(-0.5)) ...            - 0.5*(x(1)^(-1))*x(2)*(x(3)^(-0.5))*x(5) ...            - 0.65*(x(2)^(-2))*x(5)*(x(6)^(-1))*x(7);%      dg(3,4) = 0.0;%      dg(3,5) = -2*x(1)*(x(3)^(-1.5))*(x(6)^(-1))*(x(7)^(1.0/3.0)) ...            - 0.1*x(2)*(x(3)^(-0.5))*(x(6)^(-1))*(x(7)^(-0.5)) ...            - (x(1)^(-1))*x(2)*(x(3)^0.5) ...            - 0.65*(x(2)^(-2))*x(3)*(x(6)^(-1))*x(7);%      dg(3,6) = 2*x(1)*(x(3)^(-1.5))*x(5)*(x(6)^(-2))*(x(7)^(1.0/3.0)) ...            + 0.1*x(2)*(x(3)^(-0.5))*x(5)*(x(6)^(-2))*(x(7)^(-0.5)) ...            + 0.65*(x(2)^(-2))*x(3)*x(5)*(x(6)^(-2))*x(7);%      dg(3,7) = (-2.0/3.0)*x(1)*(x(3)^(-1.5))*x(5)*(x(6)^(-1))*(x(7)^(-2.0/3.0)) ...            + 0.05*x(2)*(x(3)^(-0.5))*x(5)*(x(6)^(-1))*(x(7)^(-1.5)) ...            - 0.65*(x(2)^(-2))*x(3)*x(5)*(x(6)^(-1));%%     dg(4,1) = 0.2*(x(1)^(-2))*x(2)*(x(4)^(-2))*(x(5)^0.5)*(x(7)^(1.0/3.0)) ...      dg(4,1) = 0.4*(x(1)^(-3))*x(2)*(x(4)^(-1))*(x(5)^0.5)*(x(7)^(1.0/3.0)) ...            - 0.15*(x(1)^(-0.5))*(x(2)^2)*x(3)*(x(4)^(1.0/3.0))*(x(7)^0.25) ...             *(x(5)^(-2.0/3.0)) ...            + 1.2*(x(1)^(-4))*(x(2)^(-2))*x(3)*x(5)*(x(7)^0.75);%      dg(4,2) = -0.2*(x(1)^(-2))*(x(4)^(-1))*(x(5)^0.5)*(x(7)^(1.0/3.0)) ...            - 0.6*(x(1)^0.5)*x(2)*x(3)*(x(4)^(1.0/3.0))*(x(7)^0.25) ...             *(x(5)^(-2.0/3.0)) ...            + 0.8*(x(1)^(-3))*(x(2)^(-3))*x(3)*x(5)*(x(7)^0.75);%      dg(4,3) = -0.3*(x(1)^0.5)*(x(2)^2)*(x(4)^(1.0/3.0))*(x(7)^0.25) ...            *(x(5)^(-2.0/3.0)) ...            - 0.4*(x(1)^(-3))*(x(2)^(-2))*x(5)*(x(7)^0.75) ...            + (x(3)^(-3))*x(4)*(x(7)^0.5);%      dg(4,4) = 0.2*(x(1)^(-2))*x(2)*(x(4)^(-2))*(x(5)^0.5)*(x(7)^(1.0/3.0)) ...            - 0.1*(x(1)^0.5)*(x(2)^2)*x(3)*(x(4)^(-2.0/3.0))*(x(7)^0.25) ...             *(x(5)^(-2.0/3.0)) ...            - 0.5*(x(3)^(-2))*(x(7)^0.5);%%     dg(4,5) = -(x(1)^(-2))*x(2)*(x(4)^(-1))*(x(5)^(-0.5))*(x(7)^(1.0/3.0)) ...      dg(4,5) = -.1*(x(1)^(-2))*x(2)*(x(4)^(-1))*(x(5)^(-0.5))*(x(7)^(1.0/3.0)) ...            + 0.2*(x(1)^0.5)*(x(2)^2)*x(3)*(x(4)^(1.0/3.0))*(x(7)^0.25) ...             *(x(5)^(-5.0/3.0)) ...            - 0.4*(x(1)^(-3))*(x(2)^(-2))*x(3)*(x(7)^0.75);%      dg(4,6) = 0.0;%%     dg(4,7) = (2./30.)*(x(1)^(-2))*x(2)*(x(4)^(-1))*(x(5)^.5)*(x(7)^(-2./3.)) ...      dg(4,7) =-(2./30.)*(x(1)^(-2))*x(2)*(x(4)^(-1))*(x(5)^.5)*(x(7)^(-2./3.)) ...            - 0.075*(x(1)^0.5)*(x(2)^2)*x(3)*(x(4)^(1.0/3.0))*(x(7)^(-0.75)) ...             *(x(5)^(-2.0/3.0)) ...            - 0.3*(x(1)^(-3))*(x(2)^(-2))*x(3)*x(5)*(x(7)^(-0.25)) ...            - 0.25*(x(3)^(-2))*x(4)*(x(7)^(-0.5));%      dg(5,:) = df;      dg(6,:) = -df;%%   problem 18:elseif pnum==18      df(1) = 0.67*0.4*(x(7)^(-0.67))*(x(1)^0.33) - 1;      df(2) = 0.67*0.4*(x(8)^(-0.67))*(x(2)^0.33) - 1;      df(3) = 0;      df(4) = 0;      df(5) = 0;      df(6) = 0;      df(7) = -0.67*0.4*(x(1)^.67)*(x(7)^(-1.67));      df(8) = -0.67*0.4*(x(2)^.67)*(x(8)^(-1.67));%      dg=zeros(ng,nx);      dg(5,:) = df;      dg(6,:) = -df;%      dg(1,1) = -.1;      dg(1,5) = -0.0588*x(7);      dg(1,7) = -0.0588*x(5);      dg(2,1) = -.1;      dg(2,2) = -.1;      dg(2,6) = -0.0588*x(8);      dg(2,8) = -0.0588*x(6);      dg(3,3) = 1.42*(x(3)^(-1.71))*(x(5)^(-1))-4*x(5)^(-1)+.07644*x(7)*x(3)^(-2.3);      dg(3,5) = 4*x(3)*x(5)^(-2) + 2*(x(3)^(-0.71))*x(5)^(-2);      dg(3,7) = -0.0588*x(3)^(-1.3);      dg(4,4) = 1.42*(x(4)^(-1.71))*(x(6)^(-1))-4*x(6)^(-1)+.07644*x(8)*x(4)^(-2.3);      dg(4,6) = 4*x(3)*x(5)^(-2) + 2*(x(3)^(-0.71))*x(5)^(-2);      dg(4,8) = -0.0588*x(4)^(-1.3);% Mark Spillman's problemelseif pnum==19	t= exp(x(1))*(4*x(1)^2+2*x(2)^2+4*x(1)*x(2)+2*x(2)+1);	df=[t+4*exp(x(1))*(2*x(1)+x(2));4*exp(x(1))*(x(1)+x(2)+0.5)];	dg=[x(2)-1 -x(2);x(1)-1  -x(1)];% chopper problem from Ed Pohl's Mech 620 student.elseif pnum==20 || pnum==21	df(1)=-x(2)*sin(x(5)-pi*x(3)/2700)+32*x(1)-x(2)*cos(x(5)-pi*x(3)/2700)-x(3)+x(2)*x(6);	df(2)=-sin(x(5)-pi*x(3)/2700)*x(1)-cos(x(5)-pi*x(3)/2700)*x(1)+x(1)*x(6);	df(3)=(x(2)*cos(x(5)-pi*x(3)/2700)*pi*x(1))/2700-((x(2)*sin(x(5)-pi*x(3)/2700)*pi)/2700+1)*x(1);	df(4)=-1+x(4)^(x(4)/2000)*(log(x(4))/2000+1/2000)*x(6);	df(5)=-x(2)*cos(x(5)-pi*x(3)/2700)*x(1)+x(2)*sin(x(5)-pi*x(3)/2700)*x(1);	df(6)=x(2)*x(1)+x(4)^(x(4)/2000);	dg(1,1)=0;%  Introduce following error to force line search termination.% 	dg(2,1)=-((2^(x(2)/5000)-1)^3*2^(x(2)/5000)*log(2))/1250;	dg(2,1)=-((2^(x(2)/5000)-1)^4)*log(2)*(((x(2)/5000)-1)^3)/1250;	dg(3,1)=0;	dg(4,1)=0;	dg(5,1)=0;	dg(6,1)=1;	dg(1,2)=-x(2)*sin(x(5))+32*x(1);	dg(2,2)=-sin(x(5))*x(1);	dg(3,2)=0;	dg(4,2)=0;	dg(5,2)=-x(2)*cos(x(5))*x(1);	dg(6,2)=0;%  Correct deliberate error.	if pnum==21		dg(2,1)=-((2^(x(2)/5000)-1)^3*2^(x(2)/5000)*log(2))/1250;	endelse	pnum %#ok<*NOPRT>	error('Bad pnum')endif pnum<=18, dg=-dg'; endif length(df)~=nx, disp(pnum), nx,disp(df), error('Gradient wrong length'), endif ~isempty(dg) && (size(dg,1)~=nx || size(dg,2)~=ng)   pnum,nx,ng,dg, error('Gradients wrong length')endif exist('ACTIVE_CONSTRAINTS','var') && activeSet   if length(ACTIVE_CONSTRAINTS) > 0 && length(ACTIVE_CONSTRAINTS) < ng %#ok<ISMT>      dg = dg(:,ACTIVE_CONSTRAINTS);   endend