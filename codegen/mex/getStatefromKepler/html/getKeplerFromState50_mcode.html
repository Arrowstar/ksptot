<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="29,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T2U3">sma</span>, <span class="var type1" id="S3T2U4">ecc</span>, <span class="var type1" id="S4T2U5">inc</span>, <span class="var type1" id="S5T2U6">raan</span>, <span class="var type1" id="S6T2U7">arg</span>, <span class="var type1" id="S7T2U8">tru</span>] = getKeplerFromState(<span class="var type1" id="S8T9U11">rVect</span>,<span class="var type1" id="S9T9U12">vVect</span>,<span class="var type1" id="S10T2U13">gmu</span>, <span class="mxinfo" id="T5:U10"><span class="var type1" id="S11T6U14">varargin</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="29,2" id="srcline2">  2</a></span><span class="line"><span class="comment">% getKeplerFromState() returns Keplerian orbital elements when provided</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% with the state (cartesian position vector, cartesian velocity vector) of</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% a spacecraft or celestial body.</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%INPUTS</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,7" id="srcline7">  7</a></span><span class="line"><span class="comment">% rVect - a 3x1 vector that contains the x,y,z components of the orbiting</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,8" id="srcline8">  8</a></span><span class="line"><span class="comment">% body's current position relative to the central body.  Units: [km]</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,9" id="srcline9">  9</a></span><span class="line"><span class="comment">% vVect - a 3x1 vector that contains the x,y,z components of the orbiting</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">% body's current velocity vector relative to the central body.  Units: [km/sec]</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">% muCB - the gravitational parameter of the central body.  Units: km^3/s^2</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%OUTPUTS</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">% sma - semi-major axis of the orbit.  Units: [km]</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">% ecc - eccentricity of the orbit.  Units: dimensionless</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">% inc - inclination angle of the orbit.  Units: radian</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">% raan - Longitude of ascending node of the orbit.  Units: radian</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">% arg - Argument of periapse of the orbit.  Units: radian.</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">% tru - Current true anomaly of the spacecraft/body in the orbit.</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">% Units: radian</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,21" id="srcline21"> 21</a></span><span class="line"><span class="keyword">if</span>(~isempty(<span class="var type1" id="S11T6U21">varargin</span>))</span></span>
<span class="srcline"><span class="lineno"><a href="29,22" id="srcline22"> 22</a></span><span class="line">    <span class="mxinfo" id="T5:U13"><span class="var type1" id="S13T5U24">consistencyCheck</span> = <span class="mxinfo" id="T5:U15"><span class="var type1" id="S11T6U26">varargin</span>{1}</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,23" id="srcline23"> 23</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,24" id="srcline24"> 24</a></span><span class="line">    <span class="var type2" id="S13T0U31">consistencyCheck</span> = true;</span></span>
<span class="srcline"><span class="lineno"><a href="29,25" id="srcline25"> 25</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,26" id="srcline26"> 26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,27" id="srcline27"> 27</a></span><span class="line"><span class="mxinfo" id="T9:U17"><span class="var type1" id="S8T9U36">rVect</span> = <span class="mxinfo" id="T9:U19">reshape(<span class="var type1" id="S8T9U39">rVect</span>,3,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,28" id="srcline28"> 28</a></span><span class="line"><span class="mxinfo" id="T9:U21"><span class="var type1" id="S9T9U44">vVect</span> = <span class="mxinfo" id="T9:U23">reshape(<span class="var type1" id="S9T9U47">vVect</span>,3,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,29" id="srcline29"> 29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">% i_hat = [1; 0; 0];</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,31" id="srcline31"> 31</a></span><span class="line"><span class="mxinfo" id="T9:U25"><span class="var type1" id="S16T9U52">k_hat</span> = <span class="mxinfo" id="T9:U27">[0; 0; 1]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,32" id="srcline32"> 32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,33" id="srcline33"> 33</a></span><span class="line"><span class="mxinfo" id="T9:U28"><span class="var type1" id="S17T9U62">hVect</span>=<span class="mxinfo" id="T9:U30">cross(<span class="var type1" id="S8T9U65">rVect</span>,<span class="var type1" id="S9T9U66">vVect</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,34" id="srcline34"> 34</a></span><span class="line"><span class="mxinfo" id="T2:U33"><span class="var type1" id="S19T2U69">h</span>=<span class="mxinfo" id="T2:U35">norm(<span class="var type1" id="S17T9U72">hVect</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,35" id="srcline35"> 35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,36" id="srcline36"> 36</a></span><span class="line"><span class="mxinfo" id="T2:U37"><span class="var type1" id="S21T2U75">r</span>=<span class="mxinfo" id="T2:U39">norm(<span class="var type1" id="S8T9U78">rVect</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,37" id="srcline37"> 37</a></span><span class="line"><span class="mxinfo" id="T2:U41"><span class="var type1" id="S22T2U81">v</span>=<span class="mxinfo" id="T2:U43">norm(<span class="var type1" id="S9T9U84">vVect</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,38" id="srcline38"> 38</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,39" id="srcline39"> 39</a></span><span class="line"><span class="mxinfo" id="T9:U45"><span class="var type1" id="S23T9U87">nVect</span> = <span class="mxinfo" id="T9:U47">cross(<span class="mxinfo" id="T9:U48"><span class="var type1" id="S16T9U90">k_hat</span></span>, <span class="var type1" id="S17T9U91">hVect</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,40" id="srcline40"> 40</a></span><span class="line"><span class="mxinfo" id="T9:U51"><span class="var type1" id="S24T9U94">eVect</span> = <span class="mxinfo" id="T9:U53">(<span class="mxinfo" id="T9:U54"><span class="mxinfo" id="T9:U55">(<span class="mxinfo" id="T2:U56"><span class="mxinfo" id="T2:U57"><span class="var type1" id="S22T2U102">v</span>^2</span> - <span class="mxinfo" id="T2:U59"><span class="var type1" id="S10T2U105">gmu</span>/<span class="var type1" id="S21T2U106">r</span></span></span>)*<span class="var type1" id="S8T9U107">rVect</span></span> - <span class="mxinfo" id="T9:U63"><span class="mxinfo" id="T2:U64">dot(<span class="var type1" id="S8T9U111">rVect</span>,<span class="var type1" id="S9T9U112">vVect</span>)</span>*<span class="var type1" id="S9T9U113">vVect</span></span></span>)/<span class="var type1" id="S10T2U114">gmu</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,41" id="srcline41"> 41</a></span><span class="line"><span class="mxinfo" id="T2:U69"><span class="var type1" id="S3T2U117">ecc</span> = <span class="mxinfo" id="T2:U71">norm(<span class="var type1" id="S24T9U120">eVect</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,42" id="srcline42"> 42</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,43" id="srcline43"> 43</a></span><span class="line"><span class="mxinfo" id="T2:U73"><span class="var type1" id="S26T2U123">Energy</span>=<span class="mxinfo" id="T2:U75"><span class="mxinfo" id="T2:U76"><span class="mxinfo" id="T2:U77"><span class="var type1" id="S22T2U127">v</span>^2</span>/<span class="mxinfo" id="T2:U79">2</span></span> - <span class="mxinfo" id="T2:U80"><span class="var type1" id="S10T2U131">gmu</span>/<span class="var type1" id="S21T2U132">r</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,44" id="srcline44"> 44</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,45" id="srcline45"> 45</a></span><span class="line"><span class="keyword">if</span>(<span class="mxinfo" id="T5:U83"><span class="var type1" id="S3T2U137">ecc</span> ~= <span class="mxinfo" id="T2:U85">1.0</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="29,46" id="srcline46"> 46</a></span><span class="line">    <span class="mxinfo" id="T2:U86"><span class="var type1" id="S2T2U141">sma</span>=<span class="mxinfo" id="T2:U88"><span class="mxinfo" id="T2:U89">-<span class="var type1" id="S10T2U144">gmu</span></span>/(<span class="mxinfo" id="T2:U91"><span class="mxinfo" id="T2:U92">2</span>*<span class="var type1" id="S26T2U148">Energy</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,47" id="srcline47"> 47</a></span><span class="line">    <span class="mxinfo" id="T2:U94"><span class="var type1" id="S27T2U151">p</span> = <span class="mxinfo" id="T2:U96"><span class="var type1" id="S2T2U153">sma</span>*(<span class="mxinfo" id="T2:U98"><span class="mxinfo" id="T2:U99">1</span>-<span class="mxinfo" id="T2:U100"><span class="var type1" id="S3T2U158">ecc</span>^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,48" id="srcline48"> 48</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,49" id="srcline49"> 49</a></span><span class="line">    <span class="mxinfo" id="T2:U102"><span class="var type1" id="S2T2U163">sma</span> = <span class="mxinfo" id="T2:U104">Inf</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,50" id="srcline50"> 50</a></span><span class="line">    <span class="mxinfo" id="T2:U105"><span class="var type1" id="S27T2U168">p</span> = <span class="mxinfo" id="T2:U107"><span class="mxinfo" id="T2:U108"><span class="var type1" id="S19T2U171">h</span>^2</span>/<span class="var type1" id="S10T2U173">gmu</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,51" id="srcline51"> 51</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,52" id="srcline52"> 52</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,53" id="srcline53"> 53</a></span><span class="line"><span class="mxinfo" id="T2:U111"><span class="var type1" id="S29T2U176">cosInc</span> = <span class="mxinfo" id="T2:U113"><span class="mxinfo" id="T2:U114"><span class="var type1" id="S17T9U179">hVect</span>(<span class="mxinfo" id="T2:U116">3</span>)</span> / <span class="var type1" id="S19T2U181">h</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,54" id="srcline54"> 54</a></span><span class="line"><span class="mxinfo" id="T2:U118"><span class="var type1" id="S4T2U184">inc</span> = real(<span class="mxinfo" id="T2:U120">acos(<span class="var type1" id="S29T2U189">cosInc</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,55" id="srcline55"> 55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,56" id="srcline56"> 56</a></span><span class="line"><span class="mxinfo" id="T2:U122"><span class="var type1" id="S32T2U192">cosRAAN</span> = <span class="mxinfo" id="T2:U124"><span class="mxinfo" id="T2:U125"><span class="var type1" id="S23T9U195">nVect</span>(<span class="mxinfo" id="T2:U127">1</span>)</span>/<span class="mxinfo" id="T2:U128">norm(<span class="var type1" id="S23T9U199">nVect</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,57" id="srcline57"> 57</a></span><span class="line"><span class="mxinfo" id="T2:U130"><span class="var type1" id="S5T2U202">raan</span> = real(<span class="mxinfo" id="T2:U132">acos(<span class="var type1" id="S32T2U207">cosRAAN</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,58" id="srcline58"> 58</a></span><span class="line"><span class="keyword">if</span>(<span class="mxinfo" id="T5:U134"><span class="mxinfo" id="T2:U135"><span class="var type1" id="S23T9U213">nVect</span>(<span class="mxinfo" id="T2:U137">2</span>)</span> &lt; <span class="mxinfo" id="T2:U138">0</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="29,59" id="srcline59"> 59</a></span><span class="line">    <span class="mxinfo" id="T2:U139"><span class="var type1" id="S5T2U218">raan</span> = <span class="mxinfo" id="T2:U141"><span class="mxinfo" id="T2:U142"><span class="mxinfo" id="T2:U143">2</span>*<span class="mxinfo" id="T2:U144">pi</span></span> - <span class="var type1" id="S5T2U224">raan</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,60" id="srcline60"> 60</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,61" id="srcline61"> 61</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,62" id="srcline62"> 62</a></span><span class="line"><span class="mxinfo" id="T2:U146"><span class="var type1" id="S34T2U227">cosArg</span> = <span class="mxinfo" id="T2:U148"><span class="mxinfo" id="T2:U149">dot(<span class="var type1" id="S23T9U231">nVect</span>, <span class="var type1" id="S24T9U232">eVect</span>)</span>/(<span class="mxinfo" id="T2:U152"><span class="mxinfo" id="T2:U153">norm(<span class="var type1" id="S23T9U237">nVect</span>)</span> * <span class="mxinfo" id="T2:U155">norm(<span class="var type1" id="S24T9U240">eVect</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,63" id="srcline63"> 63</a></span><span class="line"><span class="mxinfo" id="T2:U157"><span class="var type1" id="S6T2U243">arg</span> = real(<span class="mxinfo" id="T2:U159">acos(<span class="var type1" id="S34T2U248">cosArg</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,64" id="srcline64"> 64</a></span><span class="line"><span class="keyword">if</span>(<span class="mxinfo" id="T5:U161"><span class="mxinfo" id="T2:U162"><span class="var type1" id="S24T9U254">eVect</span>(<span class="mxinfo" id="T2:U164">3</span>)</span> &lt; <span class="mxinfo" id="T2:U165">0</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="29,65" id="srcline65"> 65</a></span><span class="line">    <span class="mxinfo" id="T2:U166"><span class="var type1" id="S6T2U259">arg</span> = <span class="mxinfo" id="T2:U168"><span class="mxinfo" id="T2:U169"><span class="mxinfo" id="T2:U170">2</span>*<span class="mxinfo" id="T2:U171">pi</span></span> - <span class="var type1" id="S6T2U265">arg</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,66" id="srcline66"> 66</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,67" id="srcline67"> 67</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,68" id="srcline68"> 68</a></span><span class="line"><span class="mxinfo" id="T2:U173"><span class="var type1" id="S35T2U268">cosTru</span> = <span class="mxinfo" id="T2:U175"><span class="mxinfo" id="T2:U176">dot(<span class="var type1" id="S24T9U272">eVect</span>, <span class="var type1" id="S8T9U273">rVect</span>)</span> / (<span class="mxinfo" id="T2:U179"><span class="mxinfo" id="T2:U180">norm(<span class="var type1" id="S24T9U278">eVect</span>)</span> * <span class="mxinfo" id="T2:U182">norm(<span class="var type1" id="S8T9U281">rVect</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,69" id="srcline69"> 69</a></span><span class="line"><span class="mxinfo" id="T2:U184"><span class="var type1" id="S7T2U284">tru</span> = real(<span class="mxinfo" id="T2:U186">acos(<span class="var type1" id="S35T2U289">cosTru</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,70" id="srcline70"> 70</a></span><span class="line"><span class="keyword">if</span>(<span class="mxinfo" id="T5:U188"><span class="mxinfo" id="T2:U189">dot(<span class="var type1" id="S8T9U296">rVect</span>,<span class="var type1" id="S9T9U297">vVect</span>)</span>&lt;<span class="mxinfo" id="T2:U192">0</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="29,71" id="srcline71"> 71</a></span><span class="line">    <span class="mxinfo" id="T2:U193"><span class="var type1" id="S7T2U301">tru</span> = <span class="mxinfo" id="T2:U195">-<span class="var type1" id="S7T2U303">tru</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,72" id="srcline72"> 72</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,73" id="srcline73"> 73</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,74" id="srcline74"> 74</a></span><span class="line"><span class="comment">%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,75" id="srcline75"> 75</a></span><span class="line"><span class="comment">% Special Case: Elliptical Equitorial</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,76" id="srcline76"> 76</a></span><span class="line"><span class="comment">%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,77" id="srcline77"> 77</a></span><span class="line"><span class="keyword">if</span>(<span class="mxinfo" id="T5:U197"><span class="var type1" id="S3T2U309">ecc</span> &gt;= <span class="mxinfo" id="T2:U199">1E-10</span></span> &amp;&amp; (<span class="mxinfo" id="T5:U200"><span class="var type1" id="S4T2U314">inc</span> &lt; <span class="mxinfo" id="T2:U202">1E-10</span></span> || <span class="mxinfo" id="T5:U203"><span class="mxinfo" id="T2:U204">abs(<span class="mxinfo" id="T2:U205"><span class="var type1" id="S4T2U320">inc</span>-<span class="mxinfo" id="T2:U207">pi</span></span>)</span> &lt; <span class="mxinfo" id="T2:U208">1E-10</span></span>))</span></span>
<span class="srcline"><span class="lineno"><a href="29,78" id="srcline78"> 78</a></span><span class="line">    <span class="mxinfo" id="T2:U209"><span class="var type1" id="S37T2U326">cosLongPeri</span> = <span class="mxinfo" id="T2:U211"><span class="mxinfo" id="T2:U212"><span class="var type1" id="S24T9U329">eVect</span>(<span class="mxinfo" id="T2:U214">1</span>)</span>/<span class="mxinfo" id="T2:U215">norm(<span class="var type1" id="S24T9U333">eVect</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,79" id="srcline79"> 79</a></span><span class="line">    <span class="keyword">if</span>(<span class="mxinfo" id="T5:U217"><span class="mxinfo" id="T2:U218"><span class="var type1" id="S24T9U339">eVect</span>(<span class="mxinfo" id="T2:U220">2</span>)</span> &lt; <span class="mxinfo" id="T2:U221">0</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="29,80" id="srcline80"> 80</a></span><span class="line">        <span class="mxinfo" id="T2:U222"><span class="var type1" id="S37T2U344">cosLongPeri</span> = <span class="mxinfo" id="T2:U224"><span class="mxinfo" id="T2:U225"><span class="mxinfo" id="T2:U226">2</span>*<span class="mxinfo" id="T2:U227">pi</span></span> - <span class="var type1" id="S37T2U350">cosLongPeri</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,81" id="srcline81"> 81</a></span><span class="line">    <span class="keyword">end</span>  </span></span>
<span class="srcline"><span class="lineno"><a href="29,82" id="srcline82"> 82</a></span><span class="line">    <span class="mxinfo" id="T2:U229"><span class="var type1" id="S5T2U353">raan</span> = <span class="mxinfo" id="T2:U231">0</span></span>; <span class="comment">%these two lines are my convention, hopefully they work</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,83" id="srcline83"> 83</a></span><span class="line">    <span class="mxinfo" id="T2:U232"><span class="var type1" id="S6T2U357">arg</span> = <span class="var type1" id="S37T2U358">cosLongPeri</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,84" id="srcline84"> 84</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,85" id="srcline85"> 85</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,87" id="srcline87"> 87</a></span><span class="line"><span class="comment">% Special Case: Circular Inclined</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,88" id="srcline88"> 88</a></span><span class="line"><span class="comment">%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,89" id="srcline89"> 89</a></span><span class="line"><span class="keyword">if</span>(<span class="mxinfo" id="T5:U235"><span class="var type1" id="S3T2U365">ecc</span> &lt; <span class="mxinfo" id="T2:U237">1E-10</span></span> &amp;&amp; <span class="mxinfo" id="T5:U238"><span class="var type1" id="S4T2U368">inc</span> &gt;= <span class="mxinfo" id="T2:U240">1E-10</span></span> &amp;&amp; <span class="mxinfo" id="T5:U241"><span class="mxinfo" id="T2:U242">abs(<span class="mxinfo" id="T2:U243"><span class="var type1" id="S4T2U374">inc</span>-<span class="mxinfo" id="T2:U245">pi</span></span>)</span> &gt;= <span class="mxinfo" id="T2:U246">1E-10</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="29,90" id="srcline90"> 90</a></span><span class="line">    <span class="mxinfo" id="T2:U247"><span class="var type1" id="S38T2U380">u</span> = real(<span class="mxinfo" id="T2:U249">acos(<span class="mxinfo" id="T2:U250"><span class="mxinfo" id="T2:U251">dot(<span class="var type1" id="S23T9U388">nVect</span>,<span class="var type1" id="S8T9U389">rVect</span>)</span>/(<span class="mxinfo" id="T2:U254"><span class="mxinfo" id="T2:U255">norm(<span class="var type1" id="S23T9U394">nVect</span>)</span>*<span class="mxinfo" id="T2:U257">norm(<span class="var type1" id="S8T9U397">rVect</span>)</span></span>)</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,91" id="srcline91"> 91</a></span><span class="line">    <span class="keyword">if</span>(<span class="mxinfo" id="T5:U259"><span class="mxinfo" id="T2:U260"><span class="var type1" id="S8T9U403">rVect</span>(<span class="mxinfo" id="T2:U262">3</span>)</span> &lt; <span class="mxinfo" id="T2:U263">0</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="29,92" id="srcline92"> 92</a></span><span class="line">        <span class="mxinfo" id="T2:U264"><span class="var type1" id="S38T2U408">u</span> = <span class="mxinfo" id="T2:U266"><span class="mxinfo" id="T2:U267"><span class="mxinfo" id="T2:U268">2</span>*<span class="mxinfo" id="T2:U269">pi</span></span> - <span class="var type1" id="S38T2U414">u</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,93" id="srcline93"> 93</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,94" id="srcline94"> 94</a></span><span class="line">    <span class="mxinfo" id="T2:U271"><span class="var type1" id="S7T2U417">tru</span> = <span class="var type1" id="S38T2U418">u</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,95" id="srcline95"> 95</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,96" id="srcline96"> 96</a></span><span class="line">    <span class="mxinfo" id="T2:U274"><span class="var type1" id="S6T2U421">arg</span> = <span class="mxinfo" id="T2:U276">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,97" id="srcline97"> 97</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,98" id="srcline98"> 98</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,99" id="srcline99"> 99</a></span><span class="line"><span class="comment">%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,100" id="srcline100">100</a></span><span class="line"><span class="comment">% Special Case: Circular Equitorial</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,101" id="srcline101">101</a></span><span class="line"><span class="comment">%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,102" id="srcline102">102</a></span><span class="line"><span class="keyword">if</span>(<span class="mxinfo" id="T5:U277"><span class="var type1" id="S3T2U428">ecc</span> &lt; <span class="mxinfo" id="T2:U279">1E-10</span></span> &amp;&amp; (<span class="mxinfo" id="T5:U280"><span class="var type1" id="S4T2U433">inc</span> &lt; <span class="mxinfo" id="T2:U282">1E-10</span></span> || <span class="mxinfo" id="T5:U283"><span class="mxinfo" id="T2:U284">abs(<span class="mxinfo" id="T2:U285"><span class="var type1" id="S4T2U439">inc</span>-<span class="mxinfo" id="T2:U287">pi</span></span>)</span> &lt; <span class="mxinfo" id="T2:U288">1E-10</span></span>))</span></span>
<span class="srcline"><span class="lineno"><a href="29,103" id="srcline103">103</a></span><span class="line">    <span class="mxinfo" id="T2:U289"><span class="var type1" id="S39T2U445">l</span> = real(<span class="mxinfo" id="T2:U291">acos(<span class="mxinfo" id="T2:U292"><span class="mxinfo" id="T2:U293"><span class="var type1" id="S8T9U452">rVect</span>(<span class="mxinfo" id="T2:U295">1</span>)</span>/<span class="mxinfo" id="T2:U296">norm(<span class="var type1" id="S8T9U456">rVect</span>)</span></span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,104" id="srcline104">104</a></span><span class="line">    <span class="keyword">if</span>(<span class="mxinfo" id="T5:U298"><span class="mxinfo" id="T2:U299"><span class="var type1" id="S8T9U462">rVect</span>(<span class="mxinfo" id="T2:U301">2</span>)</span>&lt;<span class="mxinfo" id="T2:U302">0</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="29,105" id="srcline105">105</a></span><span class="line">        <span class="mxinfo" id="T2:U303"><span class="var type1" id="S39T2U467">l</span> = <span class="mxinfo" id="T2:U305"><span class="mxinfo" id="T2:U306"><span class="mxinfo" id="T2:U307">2</span>*<span class="mxinfo" id="T2:U308">pi</span></span>-<span class="var type1" id="S39T2U473">l</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,106" id="srcline106">106</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,107" id="srcline107">107</a></span><span class="line">    <span class="mxinfo" id="T2:U310"><span class="var type1" id="S7T2U476">tru</span> = <span class="var type1" id="S39T2U477">l</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,108" id="srcline108">108</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,109" id="srcline109">109</a></span><span class="line">    <span class="mxinfo" id="T2:U313"><span class="var type1" id="S5T2U480">raan</span> = <span class="mxinfo" id="T2:U315">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,110" id="srcline110">110</a></span><span class="line">    <span class="mxinfo" id="T2:U316"><span class="var type1" id="S6T2U484">arg</span> = <span class="mxinfo" id="T2:U318">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,111" id="srcline111">111</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,112" id="srcline112">112</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,113" id="srcline113">113</a></span><span class="line"><span class="keyword">if</span>(<span class="mxinfo" id="T5:U319"><span class="var type1" id="S3T2U490">ecc</span>&lt;<span class="mxinfo" id="T2:U321">1.0</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="29,114" id="srcline114">114</a></span><span class="line">    <span class="mxinfo" id="T2:U322"><span class="var type1" id="S7T2U494">tru</span>=<span class="mxinfo" id="T2:U324"><span class="fcn" id="F103N2:B496">AngleZero2Pi</span>(<span class="var type1" id="S7T2U497">tru</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,115" id="srcline115">115</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,116" id="srcline116">116</a></span><span class="line">    <span class="mxinfo" id="T2:U326"><span class="var type1" id="S7T2U501">tru</span> = <span class="mxinfo" id="T2:U328"><span class="fcn" id="F104N3:B503">angleNegPiToPi</span>(<span class="var type1" id="S7T2U504">tru</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,117" id="srcline117">117</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,118" id="srcline118">118</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,119" id="srcline119">119</a></span><span class="line"><span class="keyword">if</span>(<span class="var type1" id="S13T5U508">consistencyCheck</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="29,120" id="srcline120">120</a></span><span class="line">    [<span class="var type0" id="S42T0U512">rVect2</span>,~]=getStatefromKepler(<span class="var type2" id="S2T0U516">sma</span>, <span class="var type2" id="S3T0U517">ecc</span>, <span class="var type2" id="S4T0U518">inc</span>, <span class="var type2" id="S5T0U519">raan</span>, <span class="var type2" id="S6T0U520">arg</span>, <span class="var type2" id="S7T0U521">tru</span>, <span class="var type2" id="S10T0U522">gmu</span>, false);</span></span>
<span class="srcline"><span class="lineno"><a href="29,121" id="srcline121">121</a></span><span class="line">    <span class="var type0" id="S45T0U527">rDang</span> = real(acos(dot(<span class="var type2" id="S8T0U535">rVect</span>,<span class="var type0" id="S42T0U536">rVect2</span>)/(norm(<span class="var type2" id="S8T0U541">rVect</span>) * norm(<span class="var type0" id="S42T0U544">rVect2</span>))));</span></span>
<span class="srcline"><span class="lineno"><a href="29,122" id="srcline122">122</a></span><span class="line">    <span class="keyword">if</span>(<span class="var type0" id="S45T0U549">rDang</span> &lt; 1E-6)</span></span>
<span class="srcline"><span class="lineno"><a href="29,123" id="srcline123">123</a></span><span class="line">        <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,124" id="srcline124">124</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,125" id="srcline125">125</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,126" id="srcline126">126</a></span><span class="line">    [<span class="var type0" id="S46T0U555">rVect3</span>,~]=getStatefromKepler(<span class="var type2" id="S2T0U559">sma</span>, <span class="var type2" id="S3T0U560">ecc</span>, <span class="var type2" id="S4T0U561">inc</span>, <span class="var type2" id="S5T0U563">raan</span>-<span class="var type0" id="S45T0U564">rDang</span>, <span class="var type2" id="S6T0U566">arg</span>+<span class="var type0" id="S45T0U567">rDang</span>, <span class="var type2" id="S7T0U568">tru</span>, <span class="var type2" id="S10T0U569">gmu</span>, false);</span></span>
<span class="srcline"><span class="lineno"><a href="29,127" id="srcline127">127</a></span><span class="line">    <span class="var type0" id="S47T0U574">rDang2</span> = real(acos(dot(<span class="var type2" id="S8T0U582">rVect</span>,<span class="var type0" id="S46T0U583">rVect3</span>)/(norm(<span class="var type2" id="S8T0U588">rVect</span>) * norm(<span class="var type0" id="S46T0U591">rVect3</span>))));</span></span>
<span class="srcline"><span class="lineno"><a href="29,128" id="srcline128">128</a></span><span class="line">    <span class="keyword">if</span>(<span class="var type0" id="S47T0U596">rDang2</span> &lt; 1E-6)</span></span>
<span class="srcline"><span class="lineno"><a href="29,129" id="srcline129">129</a></span><span class="line">        <span class="var type2" id="S5T0U600">raan</span> = <span class="var type2" id="S5T0U602">raan</span>-<span class="var type0" id="S45T0U603">rDang</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,130" id="srcline130">130</a></span><span class="line">        <span class="var type2" id="S6T0U606">arg</span>  = <span class="var type2" id="S6T0U608">arg</span>+<span class="var type0" id="S45T0U609">rDang</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,131" id="srcline131">131</a></span><span class="line">        <span class="var type2" id="S5T0U612">raan</span> = AngleZero2Pi(<span class="var type2" id="S5T0U615">raan</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="29,132" id="srcline132">132</a></span><span class="line">        <span class="var type2" id="S6T0U618">arg</span> = AngleZero2Pi(<span class="var type2" id="S6T0U621">arg</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="29,133" id="srcline133">133</a></span><span class="line">        <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,134" id="srcline134">134</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,135" id="srcline135">135</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,136" id="srcline136">136</a></span><span class="line">    [<span class="var type0" id="S48T0U626">rVect4</span>,~]=getStatefromKepler(<span class="var type2" id="S2T0U630">sma</span>, <span class="var type2" id="S3T0U631">ecc</span>, <span class="var type2" id="S4T0U632">inc</span>, <span class="var type2" id="S5T0U634">raan</span>+<span class="var type0" id="S45T0U635">rDang</span>, <span class="var type2" id="S6T0U637">arg</span>-<span class="var type0" id="S45T0U638">rDang</span>, <span class="var type2" id="S7T0U639">tru</span>, <span class="var type2" id="S10T0U640">gmu</span>, false);</span></span>
<span class="srcline"><span class="lineno"><a href="29,137" id="srcline137">137</a></span><span class="line">    <span class="var type0" id="S49T0U645">rDang3</span> = real(acos(dot(<span class="var type2" id="S8T0U653">rVect</span>,<span class="var type0" id="S48T0U654">rVect4</span>)/(norm(<span class="var type2" id="S8T0U659">rVect</span>) * norm(<span class="var type0" id="S48T0U662">rVect4</span>))));</span></span>
<span class="srcline"><span class="lineno"><a href="29,138" id="srcline138">138</a></span><span class="line">    <span class="keyword">if</span>(<span class="var type0" id="S49T0U667">rDang3</span> &lt; 1E-6)</span></span>
<span class="srcline"><span class="lineno"><a href="29,139" id="srcline139">139</a></span><span class="line">        <span class="var type2" id="S5T0U671">raan</span> = <span class="var type2" id="S5T0U673">raan</span>+<span class="var type0" id="S45T0U674">rDang</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,140" id="srcline140">140</a></span><span class="line">        <span class="var type2" id="S6T0U677">arg</span>  = <span class="var type2" id="S6T0U679">arg</span>-<span class="var type0" id="S45T0U680">rDang</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,141" id="srcline141">141</a></span><span class="line">        <span class="var type2" id="S5T0U683">raan</span> = AngleZero2Pi(<span class="var type2" id="S5T0U686">raan</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="29,142" id="srcline142">142</a></span><span class="line">        <span class="var type2" id="S6T0U689">arg</span> = AngleZero2Pi(<span class="var type2" id="S6T0U692">arg</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="29,143" id="srcline143">143</a></span><span class="line">        <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,144" id="srcline144">144</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,145" id="srcline145">145</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,146" id="srcline146">146</a></span><span class="line">    [<span class="var type0" id="S50T0U697">rVect5</span>,~]=getStatefromKepler(<span class="var type2" id="S2T0U701">sma</span>, <span class="var type2" id="S3T0U702">ecc</span>, <span class="var type2" id="S4T0U703">inc</span>, <span class="var type2" id="S5T0U705">raan</span>+<span class="var type0" id="S45T0U706">rDang</span>, <span class="var type2" id="S6T0U708">arg</span>+<span class="var type0" id="S45T0U709">rDang</span>, <span class="var type2" id="S7T0U710">tru</span>, <span class="var type2" id="S10T0U711">gmu</span>, false);</span></span>
<span class="srcline"><span class="lineno"><a href="29,147" id="srcline147">147</a></span><span class="line">    <span class="var type0" id="S51T0U716">rDang4</span> = real(acos(dot(<span class="var type2" id="S8T0U724">rVect</span>,<span class="var type0" id="S50T0U725">rVect5</span>)/(norm(<span class="var type2" id="S8T0U730">rVect</span>) * norm(<span class="var type0" id="S50T0U733">rVect5</span>))));</span></span>
<span class="srcline"><span class="lineno"><a href="29,148" id="srcline148">148</a></span><span class="line">    <span class="keyword">if</span>(<span class="var type0" id="S51T0U738">rDang4</span> &lt; 1E-6)</span></span>
<span class="srcline"><span class="lineno"><a href="29,149" id="srcline149">149</a></span><span class="line">        <span class="var type2" id="S5T0U742">raan</span> = <span class="var type2" id="S5T0U744">raan</span>+<span class="var type0" id="S45T0U745">rDang</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,150" id="srcline150">150</a></span><span class="line">        <span class="var type2" id="S6T0U748">arg</span>  = <span class="var type2" id="S6T0U750">arg</span>+<span class="var type0" id="S45T0U751">rDang</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,151" id="srcline151">151</a></span><span class="line">        <span class="var type2" id="S5T0U754">raan</span> = AngleZero2Pi(<span class="var type2" id="S5T0U757">raan</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="29,152" id="srcline152">152</a></span><span class="line">        <span class="var type2" id="S6T0U760">arg</span> = AngleZero2Pi(<span class="var type2" id="S6T0U763">arg</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="29,153" id="srcline153">153</a></span><span class="line">        <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,154" id="srcline154">154</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,155" id="srcline155">155</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,156" id="srcline156">156</a></span><span class="line">    [<span class="var type0" id="S52T0U768">rVect6</span>,~]=getStatefromKepler(<span class="var type2" id="S2T0U772">sma</span>, <span class="var type2" id="S3T0U773">ecc</span>, <span class="var type2" id="S4T0U774">inc</span>, <span class="var type2" id="S5T0U776">raan</span>-<span class="var type0" id="S45T0U777">rDang</span>, <span class="var type2" id="S6T0U779">arg</span>-<span class="var type0" id="S45T0U780">rDang</span>, <span class="var type2" id="S7T0U781">tru</span>, <span class="var type2" id="S10T0U782">gmu</span>, false);</span></span>
<span class="srcline"><span class="lineno"><a href="29,157" id="srcline157">157</a></span><span class="line">    <span class="var type0" id="S53T0U787">rDang5</span> = real(acos(dot(<span class="var type2" id="S8T0U795">rVect</span>,<span class="var type0" id="S52T0U796">rVect6</span>)/(norm(<span class="var type2" id="S8T0U801">rVect</span>) * norm(<span class="var type0" id="S52T0U804">rVect6</span>))));</span></span>
<span class="srcline"><span class="lineno"><a href="29,158" id="srcline158">158</a></span><span class="line">    <span class="keyword">if</span>(<span class="var type0" id="S53T0U809">rDang5</span> &lt; 1E-6)</span></span>
<span class="srcline"><span class="lineno"><a href="29,159" id="srcline159">159</a></span><span class="line">        <span class="var type2" id="S5T0U813">raan</span> = <span class="var type2" id="S5T0U815">raan</span>-<span class="var type0" id="S45T0U816">rDang</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,160" id="srcline160">160</a></span><span class="line">        <span class="var type2" id="S6T0U819">arg</span>  = <span class="var type2" id="S6T0U821">arg</span>-<span class="var type0" id="S45T0U822">rDang</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,161" id="srcline161">161</a></span><span class="line">        <span class="var type2" id="S5T0U825">raan</span> = AngleZero2Pi(<span class="var type2" id="S5T0U828">raan</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="29,162" id="srcline162">162</a></span><span class="line">        <span class="var type2" id="S6T0U831">arg</span> = AngleZero2Pi(<span class="var type2" id="S6T0U834">arg</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="29,163" id="srcline163">163</a></span><span class="line">        <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,164" id="srcline164">164</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,165" id="srcline165">165</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,166" id="srcline166">166</a></span><span class="line">    [<span class="var type0" id="S54T0U839">rVect7</span>,~]=getStatefromKepler(<span class="var type2" id="S2T0U843">sma</span>, <span class="var type2" id="S3T0U844">ecc</span>, <span class="var type2" id="S4T0U845">inc</span>, <span class="var type2" id="S5T0U846">raan</span>, <span class="var type2" id="S6T0U847">arg</span>, <span class="var type2" id="S7T0U849">tru</span>-<span class="var type0" id="S45T0U850">rDang</span>, <span class="var type2" id="S10T0U851">gmu</span>, false);</span></span>
<span class="srcline"><span class="lineno"><a href="29,167" id="srcline167">167</a></span><span class="line">    <span class="var type0" id="S55T0U856">rDang6</span> = real(acos(dot(<span class="var type2" id="S8T0U864">rVect</span>,<span class="var type0" id="S54T0U865">rVect7</span>)/(norm(<span class="var type2" id="S8T0U870">rVect</span>) * norm(<span class="var type0" id="S54T0U873">rVect7</span>))));</span></span>
<span class="srcline"><span class="lineno"><a href="29,168" id="srcline168">168</a></span><span class="line">    <span class="keyword">if</span>(<span class="var type0" id="S55T0U878">rDang6</span> &lt; 1E-6)</span></span>
<span class="srcline"><span class="lineno"><a href="29,169" id="srcline169">169</a></span><span class="line">        <span class="var type2" id="S7T0U882">tru</span> = <span class="var type2" id="S7T0U884">tru</span>-<span class="var type0" id="S45T0U885">rDang</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,170" id="srcline170">170</a></span><span class="line">        <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,171" id="srcline171">171</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,172" id="srcline172">172</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,173" id="srcline173">173</a></span><span class="line">    [<span class="var type0" id="S56T0U890">rVect8</span>,~]=getStatefromKepler(<span class="var type2" id="S2T0U894">sma</span>, <span class="var type2" id="S3T0U895">ecc</span>, <span class="var type2" id="S4T0U896">inc</span>, <span class="var type2" id="S5T0U897">raan</span>, <span class="var type2" id="S6T0U898">arg</span>, <span class="var type2" id="S7T0U900">tru</span>+<span class="var type0" id="S45T0U901">rDang</span>, <span class="var type2" id="S10T0U902">gmu</span>, false);</span></span>
<span class="srcline"><span class="lineno"><a href="29,174" id="srcline174">174</a></span><span class="line">    <span class="var type0" id="S57T0U907">rDang7</span> = real(acos(dot(<span class="var type2" id="S8T0U915">rVect</span>,<span class="var type0" id="S56T0U916">rVect8</span>)/(norm(<span class="var type2" id="S8T0U921">rVect</span>) * norm(<span class="var type0" id="S56T0U924">rVect8</span>))));</span></span>
<span class="srcline"><span class="lineno"><a href="29,175" id="srcline175">175</a></span><span class="line">    <span class="keyword">if</span>(<span class="var type0" id="S57T0U929">rDang7</span> &lt; 1E-6)</span></span>
<span class="srcline"><span class="lineno"><a href="29,176" id="srcline176">176</a></span><span class="line">        <span class="var type2" id="S7T0U933">tru</span> = <span class="var type2" id="S7T0U935">tru</span>+<span class="var type0" id="S45T0U936">rDang</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,177" id="srcline177">177</a></span><span class="line">        <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,178" id="srcline178">178</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,179" id="srcline179">179</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
</pre>
